// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  email       String   @unique
  password    String
  name        String?
  location    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  resumes         Resume[]
  skills          Skill[]
  careerGoals     CareerGoal[]
  jobDescriptions JobDescription[]
  aiChats         AIChat[]
  interviewSessions InterviewSession[]

  @@map("users")
}

model Resume {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  title       String
  summary     String?
  experience  Json     // Array of experience objects
  education   Json     // Array of education objects
  skills      Json     // Array of skills
  projects    Json?    // Array of project objects
  template    String   @default("minimal")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("resumes")
}

model Skill {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  name        String
  category    String   // e.g., "Technical", "Soft", "Language"
  proficiency String   // "Beginner", "Intermediate", "Advanced", "Expert"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("skills")
}

model CareerGoal {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  targetRole  String
  industry    String?
  timeline    String   // "Short-term", "Long-term"
  description String?
  status      String   @default("active") // "active", "achieved", "paused"
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("career_goals")
}

model JobDescription {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  title       String
  company     String?
  description String
  extractedData Json?  // AI-extracted skills, keywords, requirements
  matchScore  Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("job_descriptions")
}

model AIChat {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  role        String   // "user" or "assistant"
  content     String
  sessionId   String?  // For grouping conversations
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("ai_chats")
}

model InterviewSession {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  jobTitle    String
  company     String?
  questions   Json     // Array of question-answer pairs
  feedback    Json?    // AI-generated feedback
  score       Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("interview_sessions")
}
